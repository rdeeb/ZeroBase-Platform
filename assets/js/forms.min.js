!function(e){e(".datepicker").datepicker(),e(".colorselector").each(function(t,a){e(a).css("background",e(a).val()),e(a).ColorPicker({color:e(a).val(),livePreview:!0,onSubmit:function(t,a,i,n){e(n).val("#"+a),e(n).ColorPickerHide()},onChange:function(t,i){t.b<40?e(a).css("color","#fff"):e(a).css("color","#000"),e(a).css("background","#"+i),e(a).val("#"+i.toUpperCase())}})}),e(".uploader, .image_selector").each(function(t,a){e(a).parent(".form-field, .form_row").delegate(".delete","click",function(t){t.preventDefault(),e(a).siblings('input[type="hidden"]').val(""),e(a).siblings(".preview").remove(),e(this).remove()}),e(a).click(function(t){var i;return t.preventDefault(),i?void i.open():(i=wp.media.frames.file_frame=wp.media(e(a).hasClass("image_selector")?{title:forms_trans.image_title,button:{text:forms_trans.image_submit},library:{type:"image"},multiple:!1}:{title:forms_trans.file_title,button:{text:forms_trans.file_submit},multiple:!1}),i.on("select",function(){attachment=i.state().get("selection").first().toJSON(),e(a).siblings('input[type="hidden"]').val(attachment.id),0==e(a).parent().find(".preview").length?e(a).parent().append(e(a).hasClass("image_selector")?e('<img src="'+attachment.url+'" width="60" class="img preview" />'):e('<div class="doc preview" />')):e(a).hasClass("image_selector")&&e(a).parent(".form-field, .form_row").find(".preview").attr("src",attachment.url),0==e(a).parent().find(".delete").length&&e(a).parent().append(e(' <button class="button delete submitdelete">Remove File</button>'))}),i.on("open",function(){var t=i.state().get("selection");ids=e(a).siblings('input[type="hidden"]').val().split(","),ids.forEach(function(e){attachment=wp.media.attachment(e),attachment.fetch(),t.add(attachment?[attachment]:[])})}),void i.open())})}),e(".gallery").each(function(t,a){var i=e(a).siblings(".gallery-preview");e(a).closest(".form-field, .form_row").delegate(".delete","click",function(t){t.preventDefault(),e(this).closest("li.image").remove();var i="";return e(a).siblings(".gallery-preview").find(".image").css("cursor","default").each(function(){var t=e(this).attr("data-attachment_id");i=i+t+","}),console.log(i),e(a).siblings('input[type="hidden"]').val(i),!1}),e(a).click(function(t){var n;return t.preventDefault(),n?void n.open():(n=wp.media.frames.file_frame=wp.media({title:forms_trans.gallery_title,button:{text:forms_trans.gallery_submit},library:{type:"image"},multiple:!0}),n.on("select",function(){var t="",l=n.state().get("selection");i.html(""),l.map(function(n){n=n.toJSON(),n.id&&(t=t?t+","+n.id:n.id,i.append('                            <li class="image" data-attachment_id="'+n.id+'">                                <img src="'+n.url+'" />                                <a href="#" class="delete">Delete</a>                            </li>')),e(a).siblings('input[type="hidden"]').val(t)})}),n.on("open",function(){var t=n.state().get("selection");ids=e(a).siblings('input[type="hidden"]').val().split(","),ids.forEach(function(e){attachment=wp.media.attachment(e),attachment.fetch(),t.add(attachment?[attachment]:[])})}),void n.open())}),e(a).siblings(".gallery-preview").sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style")},update:function(){var t="";i.find(".image").each(function(){var a=e(this).attr("data-attachment_id");t=t+a+","}),console.log(t),e(a).siblings('input[type="hidden"]').val(t)}})}),e(".map-selector").each(function(t,a){var i={center:new google.maps.LatLng(9.04086,-79.483337),zoom:13};""!=e(a).find(".gmap-latlong").val()&&(i.center=e(a).find(".gmap-latlong").val());var n=e(a).find(".map-canvas"),l=new google.maps.Map(n[0],i),o=new google.maps.Marker({position:l.getCenter(),map:l,title:"Click to zoom"});google.maps.event.addListener(l,"center_changed",function(){window.setTimeout(function(){o.setPosition(l.getCenter()),e(a).find(".gmap-latlong").val(l.getCenter())},500)})})}(jQuery);